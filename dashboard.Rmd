---
title: "Global Terrorism Analysis (1970 - 2016)"
output: 
  flexdashboard::flex_dashboard:
    vertical_layout: scroll
    orientation: rows
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyr)
library(dplyr)
library(rworldmap)
library(maps)
library(ggmap)
library(reshape2)
library(raster)
library(rgdal)
library(rgeos)
library(ggmosaic)
library(shiny)
library(plotly)
```

```{r}
#source files
source ('./functions/dataImport.R', local = T)
source ('./functions/attacksOverYears.R', local = T)
source ('./functions/casualtiesOverYears.R', local = T)
source ('./functions/highCasualtyAttacks.R', local = T)
source ('./functions/highCasualtyFactor.R', local = T)
source('./functions/mostAttackedCountries.R', local = T)
source('./functions/visualizeCountMap.R', local = T)
source('./functions/visualizeFactorMap.R', local = T)
```

```{r}
terr <- dataImport()
world <- map_data("world")
```

```{r results='hide'}
#for UTF-8 encoding
Sys.setlocale('LC_ALL','C')
```

General Figures
=======================================================================

Row
-----------------------------------------------------------------------

### Years of data

```{r}
years <- terr$year %>%
  max() -
terr$year %>%
  min()

valueBox(years, icon = "ion-calendar")
```

### Total Attacks

```{r}
terr %>%
  summarise(n()) %>%
  valueBox(icon = "ion-nuclear", color = 'orange')
```

### Total Casualties

```{r}
terr %>%
  summarise(sum(casualties)) %>%
  valueBox(icon = "ion-people", color = 'red')
```

Row {.tabset}
-----------------------------------------------------------------------

### Attacks around the world

```{r}
terr %>%
  group_by(nation) %>%
  summarise(Total = n()) %>%
  visualizeCountMap(world, "Number of terrorist attacks around the world")
```

### Deaths around the world

```{r}
terr %>%
  group_by(nation) %>%
  summarise(Total = sum(Killed)) %>%
  visualizeCountMap(world, "Number of Deaths around the world")
```

### Injured around the world

```{r}
terr %>%
  group_by(nation) %>%
  summarise(Total = sum(wounded)) %>%
  visualizeCountMap(world, "Number of Injured around the world")
```

### International Attacks

```{r}
terr[c('nation', 'INT_ANY')] %>% 
  filter(INT_ANY=='1') %>%
  group_by(nation) %>%
  summarise(Total=n()) %>%
  visualizeCountMap(world, "International attacks around the globe")
```

### Domestic Attacks

```{r}
terr[c('nation', 'INT_ANY')] %>% 
  filter(INT_ANY=='0') %>%
  group_by(nation) %>%
  summarise(Total=n()) %>%
  visualizeCountMap(world, "International attacks around the globe")
```

Row
-----------------------------------------------------------------------

### Attacks over years

```{r}
attacksOverYears(terr)
```

### Casualties over years

```{r}
casualtiesOverYears(terr)
```

Factors
=======================================================================

Row {.tabset}
-----------------------------------------------------------------------

### Most used weapons across countries

```{r}
visualizeFactorMap(terr, world, 'weapon',
                   "Most used weapons in terrorist attacks around the world") %>%
  ggplotly()
```

### Most used Attack Methods across countries

```{r}
visualizeFactorMap(terr, world, 'attack',
                   "Most used attack methods around the world") %>%
  ggplotly()
```

### Major target across countries

```{r}
visualizeFactorMap(terr, world, 'target',
                   "Most attacked targets around the world") %>%
  ggplotly()
```

### Most active groups across countries

```{r}
graph <- terr %>%
  filter(gname != "Unknown") %>%
  visualizeFactorMap(world, 'gname',
                   "Most active groups around the world") +
  theme(legend.position = "none")

ggplotly(graph)
```

Row {.tabset}
-----------------------------------------------------------------------

### High Casualty Attacks

```{r}
n = 10

terr[c('target1', 'casualties')] %>%
  top_n(n, casualties) %>% 
  mutate(target1 = forcats::fct_reorder(target1, -casualties)) %>%
  highCasualtyFactor('target1', 'casualties', 
                     xlab = 'Attack Target', ylab = 'Casualty Count')
```

### High Casualty Terrorist Groups

```{r}
terr[c('gname', 'casualties')]%>%
  filter(gname!='Unknown') %>%
  group_by(gname) %>%
  summarise(casualties=n()) %>%
  top_n(n, casualties) %>%
  mutate(gname = forcats::fct_reorder(gname, -casualties)) %>%
  highCasualtyFactor('gname', 'casualties', 
                     xlab = 'Terrorist Group', ylab = 'Casualty Count')
```

### Most Attacked Countries

```{r}
terr['nation'] %>%
  group_by(nation) %>%
  summarise(Total=n()) %>%
  top_n(n, Total) %>%
  mutate(nation = forcats::fct_reorder(nation, -Total)) %>%
  highCasualtyFactor('nation', 'Total', 
                     xlab = 'Country', ylab = 'Attacks Count')
```